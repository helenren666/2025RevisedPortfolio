<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Watercolor Network with Fixed Sizes</title>
  <style>
    body { margin:0; overflow:hidden; }
    canvas { display:block; }
  </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script>
let nodes = [];
let bg;

// 9 ä¸ªçœŸå®ç»çº¬åº¦
const locations = [
  [37.5211456, -122.3140069], // 1 â†’ 3130
  [37.5341627, -122.3350642], // 2 â†’ CSM
  [37.6153981, -122.3898792], // 3 â†’ SFO
  [40.6468596, -73.7799381],  // 4 â†’ JFK
  [40.7357576, -73.9935817],  // 5 â†’ dorm
  [40.7353472, -73.9935423],  // 6 â†’ The New School
  [36.8968441, -111.4084904], // 7 â†’ phonix
  [40.8203520, -73.9787350],  // 8 â†’ sam home
  [37.3332482, -122.1089714]  // 9 â†’ home 13889
];

// âœ… å®šä¹‰è¾¹ï¼ˆé€»è¾‘è¿æ¥ï¼‰
const edges = [
  { from: 1, to: 2, color: [167, 88, 245] },   // ç´«è‰²
  { from: 1, to: 3, color: [55, 68, 163] },    // è“è‰²
  { from: 1, to: 9, color: [244, 115, 250] },  // ç²‰è‰²
  { from: 4, to: 3, color: [167, 88, 245] },   // ç´«è‰²
  { from: 4, to: 5, color: [55, 68, 163] },    // è“è‰²
  { from: 5, to: 6, color: [167, 88, 245] },   // ç´«è‰²
  { from: 3, to: 7, color: [244, 115, 250] },  // ç²‰è‰²
  { from: 3, to: 9, color: [167, 88, 245] }    // ç´«è‰²
];

function preload() {
  bg = loadImage("watercolor.jpg"); // èƒŒæ™¯å›¾
}

function setup() {
  createCanvas(windowWidth, windowHeight);

  // æ¯ä¸ªç‚¹é‡å¤ 4 æ¬¡ â†’ æ€»å…± 36 ä¸ª
  for (let rep = 0; rep < 4; rep++) {
    for (let i = 0; i < locations.length; i++) {
      let lat = locations[i][0];
      let lng = locations[i][1];

      // ğŸ¨ é¢œè‰²é€»è¾‘
      let c;
      if ([1, 9].includes(i+1)) {
        c = [55, 68, 163]; // è“è‰²
      } else if ([2, 6, 7, 8].includes(i+1)) {
        c = [244, 115, 250]; // ç²‰è‰²
      } else if ([3, 4, 5].includes(i+1)) {
        c = [167, 88, 245]; // ç´«è‰²
      }

      // ğŸ”‘ å¤§å°é€»è¾‘
      let r;
      if ([1, 6, 9].includes(i+1)) {
        r = 28; // å¤§ç‚¹ = å‘†å¾ˆä¹…
      } else if ([2, 5].includes(i+1)) {
        r = 16; // ä¸­ç­‰ = å‘†ä¸­ç­‰æ—¶é—´
      } else {
        r = 8;  // å° = å‘†å¾ˆçŸ­
      }

      // èŠ‚ç‚¹å±æ€§
      nodes.push({
        id: i+1,   // èŠ‚ç‚¹ç¼–å· (1-9)
        rep: rep,  // ç¬¬å‡ ä»½ (0-3)
        x: random(width),
        y: random(height),
        dx: random(-1, 1),
        dy: random(-1, 1),
        r: r,
        color: c,
        lat: lat,
        lng: lng,
        speedFactor: 1
      });
    }
  }
}

function draw() {
  background(255);
  image(bg, 0, 0, width, height);

  // âœ… åˆ†ç»„å†…éƒ¨è¿çº¿
  for (let rep = 0; rep < 4; rep++) {
    edges.forEach(edge => {
      let fromNode = nodes.find(n => n.id === edge.from && n.rep === rep);
      let toNode = nodes.find(n => n.id === edge.to && n.rep === rep);

      if (fromNode && toNode) {
        stroke(edge.color[0], edge.color[1], edge.color[2], 180);
        line(fromNode.x, fromNode.y, toNode.x, toNode.y);

        // ğŸ¯ åŠ¨æ€é€Ÿåº¦é€»è¾‘
        let c1 = fromNode.color;
        let c2 = toNode.color;
        if (c1[0]===c2[0] && c1[1]===c2[1] && c1[2]===c2[2]) {
          if (c1[0]===55 && c1[1]===68 && c1[2]===163) { // è“è‰²
            fromNode.speedFactor = 0.2;
            toNode.speedFactor = 0.2;
          } else {
            fromNode.speedFactor = 3; // ç²‰è‰²/ç´«è‰²ä¸€è‡´ â†’ å¿«
            toNode.speedFactor = 3;
          }
        } else {
          fromNode.speedFactor = 1;
          toNode.speedFactor = 1;
        }
      }
    });
  }

  noStroke();
  nodes.forEach(n => {
    // æ°´å½©æ™•æŸ“
    let g = drawingContext.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r*3);
    g.addColorStop(0, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 1)`);
    g.addColorStop(1, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 0)`);
    drawingContext.fillStyle = g;
    ellipse(n.x, n.y, n.r*6);

    // ä¸­å¿ƒç‚¹
    fill(n.color[0], n.color[1], n.color[2]);
    ellipse(n.x, n.y, n.r);

    // ç»çº¬åº¦æ–‡å­—
    fill(255, 220);
    textSize(n.r * 0.6);  // å­—ä½“éšç‚¹å¤§å°
    textAlign(CENTER, TOP);
    text(`${n.lat.toFixed(2)}, ${n.lng.toFixed(2)}`, n.x, n.y + n.r + 4);
    textStyle(ITALIC);

    // ç§»åŠ¨
    n.x += n.dx * n.speedFactor;
    n.y += n.dy * n.speedFactor;
    if (n.x < 0 || n.x > width) n.dx *= -1;
    if (n.y < 0 || n.y > height) n.dy *= -1;
  });
}

// ç‚¹å‡» â†’ è·³åˆ° map.html
function mousePressed() {
  for (let i = 0; i < nodes.length; i++) {
    if (dist(mouseX, mouseY, nodes[i].x, nodes[i].y) < nodes[i].r) {
      window.location.href = `map.html?lat=${nodes[i].lat}&lng=${nodes[i].lng}`;
    }
  }
}
</script>
</body>
</html>
