<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Watercolor Network with Fixed Sizes</title>
  <style>
    body { margin:0; overflow:hidden; }
    canvas { display:block; }
  </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script>
let nodes = [];
let bg;

// 9 个真实经纬度
const locations = [
  [37.5211456, -122.3140069], // 1 → 3130
  [37.5341627, -122.3350642], // 2 → CSM
  [37.6153981, -122.3898792], // 3 → SFO
  [40.6468596, -73.7799381],  // 4 → JFK
  [40.7357576, -73.9935817],  // 5 → dorm
  [40.7353472, -73.9935423],  // 6 → The New School
  [36.8968441, -111.4084904], // 7 → phonix
  [40.8203520, -73.9787350],  // 8 → sam home
  [37.3332482, -122.1089714]  // 9 → home 13889
];

// ✅ 定义边（逻辑连接）
const edges = [
  { from: 1, to: 2, color: [167, 88, 245] },   // 紫色
  { from: 1, to: 3, color: [55, 68, 163] },    // 蓝色
  { from: 1, to: 9, color: [244, 115, 250] },  // 粉色
  { from: 4, to: 3, color: [167, 88, 245] },   // 紫色
  { from: 4, to: 5, color: [55, 68, 163] },    // 蓝色
  { from: 5, to: 6, color: [167, 88, 245] },   // 紫色
  { from: 3, to: 7, color: [244, 115, 250] },  // 粉色
  { from: 3, to: 9, color: [167, 88, 245] }    // 紫色
];

function preload() {
  bg = loadImage("watercolor.jpg"); // 背景图
}

function setup() {
  createCanvas(windowWidth, windowHeight);

  // 每个点重复 4 次 → 总共 36 个
  for (let rep = 0; rep < 4; rep++) {
    for (let i = 0; i < locations.length; i++) {
      let lat = locations[i][0];
      let lng = locations[i][1];

      // 🎨 颜色逻辑
      let c;
      if ([1, 9].includes(i+1)) {
        c = [55, 68, 163]; // 蓝色
      } else if ([2, 6, 7, 8].includes(i+1)) {
        c = [244, 115, 250]; // 粉色
      } else if ([3, 4, 5].includes(i+1)) {
        c = [167, 88, 245]; // 紫色
      }

      // 🔑 大小逻辑
      let r;
      if ([1, 6, 9].includes(i+1)) {
        r = 28; // 大点 = 呆很久
      } else if ([2, 5].includes(i+1)) {
        r = 16; // 中等 = 呆中等时间
      } else {
        r = 8;  // 小 = 呆很短
      }

      // 节点属性
      nodes.push({
        id: i+1,   // 节点编号 (1-9)
        rep: rep,  // 第几份 (0-3)
        x: random(width),
        y: random(height),
        dx: random(-1, 1),
        dy: random(-1, 1),
        r: r,
        color: c,
        lat: lat,
        lng: lng,
        speedFactor: 1
      });
    }
  }
}

function draw() {
  background(255);
  image(bg, 0, 0, width, height);

  // ✅ 分组内部连线
  for (let rep = 0; rep < 4; rep++) {
    edges.forEach(edge => {
      let fromNode = nodes.find(n => n.id === edge.from && n.rep === rep);
      let toNode = nodes.find(n => n.id === edge.to && n.rep === rep);

      if (fromNode && toNode) {
        stroke(edge.color[0], edge.color[1], edge.color[2], 180);
        line(fromNode.x, fromNode.y, toNode.x, toNode.y);

        // 🎯 动态速度逻辑
        let c1 = fromNode.color;
        let c2 = toNode.color;
        if (c1[0]===c2[0] && c1[1]===c2[1] && c1[2]===c2[2]) {
          if (c1[0]===55 && c1[1]===68 && c1[2]===163) { // 蓝色
            fromNode.speedFactor = 0.2;
            toNode.speedFactor = 0.2;
          } else {
            fromNode.speedFactor = 3; // 粉色/紫色一致 → 快
            toNode.speedFactor = 3;
          }
        } else {
          fromNode.speedFactor = 1;
          toNode.speedFactor = 1;
        }
      }
    });
  }

  noStroke();
  nodes.forEach(n => {
    // 水彩晕染
    let g = drawingContext.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r*3);
    g.addColorStop(0, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 1)`);
    g.addColorStop(1, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 0)`);
    drawingContext.fillStyle = g;
    ellipse(n.x, n.y, n.r*6);

    // 中心点
    fill(n.color[0], n.color[1], n.color[2]);
    ellipse(n.x, n.y, n.r);

    // 经纬度文字
    fill(255, 220);
    textSize(n.r * 0.6);  // 字体随点大小
    textAlign(CENTER, TOP);
    text(`${n.lat.toFixed(2)}, ${n.lng.toFixed(2)}`, n.x, n.y + n.r + 4);
    textStyle(ITALIC);

    // 移动
    n.x += n.dx * n.speedFactor;
    n.y += n.dy * n.speedFactor;
    if (n.x < 0 || n.x > width) n.dx *= -1;
    if (n.y < 0 || n.y > height) n.dy *= -1;
  });
}

// 点击 → 跳到 map.html
function mousePressed() {
  for (let i = 0; i < nodes.length; i++) {
    if (dist(mouseX, mouseY, nodes[i].x, nodes[i].y) < nodes[i].r) {
      window.location.href = `map.html?lat=${nodes[i].lat}&lng=${nodes[i].lng}`;
    }
  }
}
</script>
</body>
</html>
